tags:
  - name: Users
    description: User authentication and management
  - name: Auth
    description: JWT authentication utilities
  - name: Debug
    description: Development & testing endpoints

paths:
  /users/login:
    post:
      summary: Login user
      description: Logs in a user and returns a JWT token
      tags: [Users]

      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  example: john.smith@email.com
                password:
                  type: string
                  example: PassworD123!
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  user:
                    $ref: "./components.yaml#/components/schemas/User"
                  token:
                    type: string
              examples:
                success:
                  value:
                    success: true
                    message: Login successful
                    user:
                      id: 1
                      name: John
                      surname: Smith
                      role: buyer
                      email: john.smith@email.com
                      created_at: "2025-01-01T12:00:00.000Z"
                    token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        "400":
          description: Invalid credentials or missing fields
        "403":
          description: User is banned
        "500":
          description: Server error



  paths:
  /users/register:
    post:
      summary: Register a new user
      tags: [Users]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - surname
                - email
                - password
                - verifyPassword
              properties:
                name:
                  type: string
                  example: John
                surname:
                  type: string
                  example: Smith
                email:
                  type: string
                  example: john.smith@email.com
                password:
                  type: string
                  example: "Password123!"
                verifyPassword:
                  type: string
                  example: "Password123!"
      responses:
        "201":
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
              examples:
                success:
                  value:
                    success: true
                    message: "User registered successfully! Welcome John Smith"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
              examples:
                error:
                  value:
                    success: false
                    message: "All fields are required"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
              examples:
                error:
                  value:
                    success: false
                    message: "Something went wrong"


  /users/logout:
    post:
      summary: Logout user
      description: Clears auth cookie and removes Redis cache
      tags: [Users]
      responses:
        "200":
          description: Logged out successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        "500":
          description: Server error

  /users/me:
    get:
      summary: Get logged-in user
      description: Returns authenticated user info
      tags: [Users]
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Authenticated user
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  user:
                    $ref: "./components.yaml#/components/schemas/User"
        "401":
          description: User not authenticated

  /users:
    get:
      summary: Get all users
      description: Admin/internal endpoint
      tags: [Users]
      responses:
        "200":
          description: List of users
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  users:
                    type: array
                    items:
                      $ref: "./components.yaml#/components/schemas/User"

  /users/token:
    post:
      summary: Generate JWT token
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                -id
                - name
                - surname
                - role
                - email
              properties:
                id:
                  type: integer
                  example: 5
                name:
                  type: string
                  example: John
                surname:
                  type: string
                  example: Smith
                role:
                  type: string
                  example: buyer/admin  
                email:
                  type: string
                  example: john.smith@email.com
                
      responses:
        "200":
          description: Token generated
          content:
            application/json:
              schema:
                $ref: "./components.yaml#/components/schemas/TokenResponse"

  /users/jwt-test:
    get:
      summary: Verify JWT token
      tags: [Auth]
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Token verified
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  user:
                    $ref: "./components.yaml#/components/schemas/User"

  /users/test-redis:
    get:
      summary: Test Redis cache
      description: Debug endpoint for Redis
      tags: [Debug]
      parameters:
        - in: query
          name: key
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Redis lookup result
        "400":
          description: Missing key
        "500":
          description: Redis error
