openapi: 3.0.3
info:
  title: Admin API
  description: |
    Admin-only endpoints.
    All routes require:
    - A valid JWT token
    - The authenticated user must have role = **admin**
  version: 1.0.0

servers:
  - url: http://localhost:3010
    description: Local server

tags:
  - name: Admin
    description: Admin restricted operations

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: Admin access required

    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true

paths:

  /admin/addNewUser:
    post:
      tags: [Admin]
      summary: Add a new user (admin only)
      description: Creates a new user. Requires admin role.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - surname
                - role
                - email
                - password
              properties:
                name:
                  type: string
                  example: John
                surname:
                  type: string
                  example: Doe
                role:
                  type: string
                  enum: [admin, manager, buyer]
                  example: buyer
                email:
                  type: string
                  example: john.doe@email.com
                password:
                  type: string
                  example: StrongP@ssw0rd
      responses:
        "201":
          description: User created
          content:
            application/json:
              example:
                success: true
                message: User registered successfully! Welcome John Doe
        "400":
          description: Validation error
        "401":
          description: Missing or invalid token
        "403":
          description: Admin access required

  /admin/fetchUsers:
    get:
      tags: [Admin]
      summary: Get all users
      description: Admin only
      security:
        - bearerAuth: []
      responses:
        "200":
          description: List of users
          content:
            application/json:
              example:
                success: true
                users:
                  - id: 1
                    name: John
                    surname: Doe
                    role: buyer
                    email: john@email.com
                    is_banned: false

  /admin/getBanned:
    get:
      tags: [Admin]
      summary: Get banned users
      description: Admin only
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Banned users
          content:
            application/json:
              example:
                success: true
                banned_users:
                  - id: 5
                    role: buyer
                    customer_id: 5

  /admin/toggleBannedUser:
    post:
      tags: [Admin]
      summary: Ban or unban a user
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
                - reason
              properties:
                userId:
                  type: integer
                  example: 4
                reason:
                  type: string
                  example: Violated Terms of Service
      responses:
        "200":
          description: User ban status updated
          content:
            application/json:
              example:
                success: true
                message: User 4 ban status updated
        "403":
          description: Cannot ban an admin

  /admin/addNewItem:
    post:
      tags: [Admin]
      summary: Add a new product
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - description
                - img
                - price
                - quantity
                - category
              properties:
                name:
                  type: string
                  example: iPhone 15
                description:
                  type: string
                  example: Latest Apple phone
                img:
                  type: string
                  example: https://image.url/iphone.png
                price:
                  type: number
                  example: 999.99
                quantity:
                  type: integer
                  example: 20
                category:
                  type: string
                  example: electronics
      responses:
        "200":
          description: Product created
          content:
            application/json:
              example:
                success: true
                product:
                  id: 12
                  name: iPhone 15
                  price: 999.99
                  quantity: 20
                  category: electronics

  /admin/updatePrice:
    post:
      tags: [Admin]
      summary: Update product price
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - productId
                - price
              properties:
                productId:
                  type: integer
                  example: 12
                price:
                  type: number
                  example: 899.99
      responses:
        "200":
          description: Price updated
          content:
            application/json:
              example:
                success: true
                message: Product with ID 12 price has been changed to 899.99

  /admin/updateQuantity:
    post:
      tags: [Admin]
      summary: Update product quantity
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - productId
                - quantity
              properties:
                productId:
                  type: integer
                  example: 12
                quantity:
                  type: integer
                  example: 50
      responses:
        "200":
          description: Quantity updated
          content:
            application/json:
              example:
                success: true
                message: Product with ID 12 quantity has been changed to 50

  /admin/orders/profits/daily:
    get:
      tags: [Admin]
      summary: Get daily order profits
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: range
          schema:
            type: string
            enum: [days, month, year]
        - in: query
          name: value
          schema:
            type: string
            example: "2025-01"
      responses:
        "200":
          description: Daily profit data
          content:
            application/json:
              example:
                success: true
                data:
                  - order_date: "2025-01-10"
                    total_sales: 1200.50
                    profit: 300.12
